version: '3.8'

services:
  # 1. Redis: 用來做即時排行榜、扣庫存 (快取層)
  redis:
    image: redis:alpine
    container_name: auction_redis
    ports:
      - "6379:6379"  # 開放 port 讓你的程式連線
    command: redis-server --appendonly yes # 讓資料持久化一點，避免重開全不見

  # 2. PostgreSQL: 用來存最終訂單、會員資料 (資料庫層)
  db:
    image: postgres:13-alpine
    container_name: auction_db
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: admin       # 帳號
      POSTGRES_PASSWORD: password123 # 密碼 (測試用簡單就好)
      POSTGRES_DB: auction_db    # 資料庫名稱
    volumes:
      - postgres_data:/var/lib/postgresql/data # 確保重開機資料還在

# 定義 Volumes
volumes:
  postgres_data: